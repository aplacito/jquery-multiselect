/*
 * jQuery MultiSelect Plugin 0.3
 * Copyright (c) 2010 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-multiselect-plugin-with-themeroller-support/
 * Inspired by Cory S.N. LaViska's implementation, A Beautiful Site (http://abeautifulsite.net/) 2009
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
*/
(function(f){f.fn.extend({multiSelect:function(j){j=f.extend({},m.defaults,j);return this.each(function(){new m(this,j)})}});var m=function(j,e){function n(){var a=i.find("input"),b=k.find("input"),d=b.filter(":checked"),g="",l=d.length;if(l===0)a.val(e.noneSelected);else{if(e.selectedList&&d.length<=e.selectedList)d.each(function(){var q=f(this).parent().text();g=g.length?(g+=", "+q):q});else g=e.selectedText.replace("#",l).replace("#",b.length);a.val(g).attr("title",g)}}var i=$original=f(j),c,k, h=[],r=[];h.push('<a class="ui-multiselect ui-state-default ui-corner-all"><input readonly="readonly" type="text" value="" /><span class="ui-icon ui-icon-triangle-1-s"></span></a>');h.push('<div class="ui-multiselect-options'+(e.shadow?" ui-multiselect-shadow":"")+' ui-widget ui-widget-content ui-corner-bl ui-corner-br ui-corner-tr">');if(e.showHeader){h.push('<div class="ui-widget-header ui-helper-clearfix ui-corner-all ui-multiselect-header">');h.push('<ul class="ui-helper-reset">');h.push('<li><a class="ui-multiselect-all" href=""><span class="ui-icon ui-icon-check"></span>'+ e.checkAllText+"</a></li>");h.push('<li><a class="ui-multiselect-none" href=""><span class="ui-icon ui-icon-closethick"></span>'+e.unCheckAllText+"</a></li>");h.push('<li class="ui-multiselect-close"><a href="" class="ui-multiselect-close ui-icon ui-icon-circle-close"></a></li>');h.push("</ul>");h.push("</div>")}h.push('<ul class="ui-multiselect-checkboxes ui-helper-reset">');i.find("option").each(function(){var a=f(this),b=a.val(),d=b.length,g=a.parent(),l=g.is("optgroup");if(l){g=g.attr("label"); if(f.inArray(g,r)===-1){h.push('<li class="ui-multiselect-optgroup-label"><a href="#">'+g+"</a></li>");r.push(g)}}if(d>0){h.push(l?'<li class="multiSelect-optgroup">':"<li>");h.push('<label class="ui-corner-all"><input type="checkbox" name="'+i.attr("name")+'" value="'+b+'"');a.is(":selected")&&h.push(' checked="checked"');h.push(" />"+a.html()+"</label></li>")}});h.push("</ul></div>");i=i.after(h.join("")).next("a.ui-multiselect");c=i.next("div.ui-multiselect-options");$header=c.find("div.ui-multiselect-header"); k=c.find("label");j=i.find("span.ui-icon").outerWidth();var o=$original.outerWidth(),p=o+j;if(/\d/.test(e.minWidth)&&p<e.minWidth){o=e.minWidth-j;p=e.minWidth}i.width(p+"px").find("input").width(o+"px");e.showHeader&&$header.find("a").click(function(a){var b=f(a.target);if(b.hasClass("ui-multiselect-close"))c.trigger("close");else{b=b.hasClass("ui-multiselect-all");c.trigger("toggleChecked",[b?true:false]);e[b?"onCheckAll":"onUncheckAll"].call(this)}a.preventDefault()});i.bind({click:function(){c.trigger(c.is(":hidden")? "open":"close")},keypress:function(a){a.keyCode===27&&c.trigger("close")},mouseenter:function(){f(this).addClass("ui-state-hover")},mouseleave:function(){f(this).removeClass("ui-state-hover")},focus:function(){f(this).addClass("ui-state-focus")},blur:function(){f(this).removeClass("ui-state-focus")}});c.bind({close:function(a,b){b=b||false;if(b===true)f("div.ui-multiselect-options").filter(":visible").fadeOut(e.fadeSpeed).prev("a.ui-multiselect").removeClass("ui-state-active").trigger("mouseout"); else{i.removeClass("ui-state-active").trigger("mouseout");c.fadeOut(e.fadeSpeed)}},open:function(){var a=i.position(),b=c.find("ul:eq(1)"),d,g;i.addClass("ui-state-active");c.trigger("close",[true]);d=e.position==="middle"?a.top+i.height()/2-c.outerHeight()/2:e.position==="top"?a.top-c.outerHeight():a.top+i.outerHeight();g=i.width()-parseInt(c.css("padding-left"))-parseInt(c.css("padding-right"));k.filter("label:first").trigger("mouseenter");c.css({position:"absolute",top:d+"px",left:a.left+"px", width:g+"px"}).show();b.scrollTop(0);e.maxHeight&&b.css("height",e.maxHeight);e.onOpen.call(c[0])},traverse:function(a,b,d){a=f(b);d=d===38||d===37?true:false;if(!a.parent()[d?"prev":"next"]("li").find("label").trigger("mouseenter").length){a=c.find("ul:eq(1)");c.find("label")[d?"last":"first"]().trigger("mouseover");a.scrollTop(d?a.height():0)}},toggleChecked:function(a,b,d){(d&&d.length?d:k.find("input")).attr("checked",b?"checked":"");n()}}).find("li.ui-multiselect-optgroup-label a").click(function(a){var b= f(this).parent().nextUntil("li.ui-multiselect-optgroup-label").find("input"),d=b.length,g=b.filter(":checked").length;c.trigger("toggleChecked",[g===d?false:true,b]);e.onOptgroupToggle.call(this,b.get());a.preventDefault()});k.bind({mouseenter:function(){k.removeClass("ui-state-hover");f(this).addClass("ui-state-hover").find("input").focus()},click:function(a){a.preventDefault();f(this).find("input").trigger("click",[true])},keyup:function(a){switch(a.keyCode){case 9:c.trigger("close");i.next(":input").focus(); break;case 27:c.trigger("close");break;case 38:case 40:case 37:case 39:c.trigger("traverse",[this,a.keyCode]);break;case 13:a.preventDefault();f(this).click();break}}}).find("input").bind("click",function(a,b){var d=f(this);b=b||false;a.stopPropagation();if(b){a.preventDefault();d.attr("checked",d.is(":checked")?"":"checked")}e.onCheck.call(d[0]);n()});f.fn.bgiframe&&c.bgiframe();$original.remove();n();return c};f(document).bind("click",function(j){j=f(j.target);!j.closest("div.ui-multiselect-options").length&& !j.parent().hasClass("ui-multiselect")&&f("div.ui-multiselect-options").trigger("close",[true])});m.defaults={showHeader:true,maxHeight:175,minWidth:"auto",checkAllText:"Check all",unCheckAllText:"Uncheck all",noneSelected:"Select options",selectedList:false,selectedText:"# selected",position:"bottom",shadow:false,fadeSpeed:200,onCheck:function(){},onOpen:function(){},onCheckAll:function(){},onUncheckAll:function(){},onOptgroupToggle:function(){}}})(jQuery);
